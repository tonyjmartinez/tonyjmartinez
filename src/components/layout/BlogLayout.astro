---
import BaseLayout from "./BaseLayout.astro";
import Header from "./Header.astro";
import Footer from "./Footer.astro";
import TagPill from "@components/blog/TagPill.astro";
import type { CollectionEntry } from "astro:content";

interface Props {
  post: CollectionEntry<"blog">;
}

const { post } = Astro.props;
const { title, description, publishDate, updatedDate, tags, heroImage, heroAlt } =
  post.data;

const formattedPublish = publishDate.toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});

const formattedUpdated = updatedDate?.toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});

// Rough reading time: average 200wpm, count from rendered HTML isn't possible at
// build time so we approximate from the MDX body string.
const wordCount = post.body?.split(/\s+/).length ?? 0;
const readingTime = Math.max(1, Math.ceil(wordCount / 200));
---

<BaseLayout title={title} description={description}>
  <Header />

  <main id="main-content">
    <article class="article container">
      <header class="article__header">
        {
          tags.length > 0 && (
            <ul class="article__tags" role="list" aria-label="Post tags">
              {tags.map((tag) => (
                <li>
                  <TagPill tag={tag} />
                </li>
              ))}
            </ul>
          )
        }

        <h1 class="article__title">{title}</h1>
        <p class="article__description">{description}</p>

        <div class="article__meta">
          <time datetime={publishDate.toISOString()}>
            {formattedPublish}
          </time>
          <span class="article__meta-sep" aria-hidden="true">&middot;</span>
          <span>{readingTime} min read</span>
          {
            formattedUpdated && (
              <>
                <span class="article__meta-sep" aria-hidden="true">&middot;</span>
                <span>
                  Updated <time datetime={updatedDate!.toISOString()}>{formattedUpdated}</time>
                </span>
              </>
            )
          }
        </div>
      </header>

      {
        heroImage && (
          <div class="article__hero">
            <img
              src={heroImage}
              alt={heroAlt ?? ""}
              loading="eager"
              decoding="async"
            />
          </div>
        )
      }

      <div class="prose article__body">
        <slot />
      </div>
    </article>
  </main>

  <Footer />
</BaseLayout>

<style>
  .article {
    padding-top: var(--space-16);
    padding-bottom: var(--space-20);
  }

  .article__header {
    max-width: var(--max-width-prose);
    margin-bottom: var(--space-10);
  }

  .article__tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    list-style: none;
    margin-bottom: var(--space-5);
  }

  .article__title {
    font-size: var(--text-4xl);
    font-weight: var(--font-bold);
    line-height: var(--leading-tight);
    letter-spacing: -0.03em;
    margin-bottom: var(--space-4);
  }

  @media (max-width: 640px) {
    .article__title {
      font-size: var(--text-3xl);
    }
  }

  .article__description {
    font-size: var(--text-xl);
    color: var(--color-text-secondary);
    line-height: var(--leading-snug);
    margin-bottom: var(--space-6);
  }

  .article__meta {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-text-muted);
  }

  .article__meta-sep {
    color: var(--color-border-emphasis);
  }

  .article__hero {
    max-width: var(--max-width-content);
    margin-bottom: var(--space-10);
    border-radius: var(--radius-lg);
    overflow: hidden;
  }

  .article__hero img {
    width: 100%;
    height: auto;
  }

  .article__body {
    max-width: var(--max-width-prose);
  }
</style>
