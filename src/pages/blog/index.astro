---
import PageLayout from "../../layouts/PageLayout.astro";
import PostCard from "../../components/blog/PostCard.astro";
import { getCollection } from "astro:content";
import { getReadingTime } from "../../utils/reading-time";

const allPosts = await getCollection("blog", ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

const sortedPosts = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<PageLayout title="Blog" description="Thoughts on software engineering, NBA analytics, and more.">
  <header class="mb-8">
    <h1 class="text-3xl font-bold tracking-tight text-(--color-text-primary)">
      Blog
    </h1>
    <p class="mt-2 text-(--color-text-secondary)">
      Thoughts on software engineering, NBA analytics, and more.
    </p>
  </header>

  {sortedPosts.length === 0 ? (
    <p class="text-(--color-text-muted)">No posts yet. Check back soon!</p>
  ) : (
    <div class="grid gap-6">
      {sortedPosts.map((post) => (
        <PostCard
          post={post}
          readingTime={getReadingTime(post.body ?? "")}
        />
      ))}
    </div>
  )}
</PageLayout>
